<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observers | MassTransit</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.b0a18694.css" as="style"><link rel="preload" href="/assets/js/app.f6b98727.js" as="script"><link rel="preload" href="/assets/js/3.5d941158.js" as="script"><link rel="preload" href="/assets/js/37.f96e32d8.js" as="script"><link rel="prefetch" href="/assets/js/10.49f30773.js"><link rel="prefetch" href="/assets/js/100.243463e8.js"><link rel="prefetch" href="/assets/js/101.6c574e04.js"><link rel="prefetch" href="/assets/js/102.3f8ecb5a.js"><link rel="prefetch" href="/assets/js/103.102e0b62.js"><link rel="prefetch" href="/assets/js/104.6415c50e.js"><link rel="prefetch" href="/assets/js/105.d79d3e11.js"><link rel="prefetch" href="/assets/js/106.e54af3e0.js"><link rel="prefetch" href="/assets/js/107.81005321.js"><link rel="prefetch" href="/assets/js/108.f5a33270.js"><link rel="prefetch" href="/assets/js/109.ae5298f8.js"><link rel="prefetch" href="/assets/js/11.3829db40.js"><link rel="prefetch" href="/assets/js/110.194ac2eb.js"><link rel="prefetch" href="/assets/js/111.6e7fe707.js"><link rel="prefetch" href="/assets/js/112.61cc9d22.js"><link rel="prefetch" href="/assets/js/113.d3f0314f.js"><link rel="prefetch" href="/assets/js/114.c7cb5e12.js"><link rel="prefetch" href="/assets/js/115.b6551b88.js"><link rel="prefetch" href="/assets/js/116.1496da4c.js"><link rel="prefetch" href="/assets/js/117.e885181b.js"><link rel="prefetch" href="/assets/js/118.3bbcc28f.js"><link rel="prefetch" href="/assets/js/119.e0e97b90.js"><link rel="prefetch" href="/assets/js/12.3734f329.js"><link rel="prefetch" href="/assets/js/120.444e5052.js"><link rel="prefetch" href="/assets/js/121.362cfe2e.js"><link rel="prefetch" href="/assets/js/122.eaadaf77.js"><link rel="prefetch" href="/assets/js/123.b6b5c5fd.js"><link rel="prefetch" href="/assets/js/124.9874f788.js"><link rel="prefetch" href="/assets/js/125.9193edd8.js"><link rel="prefetch" href="/assets/js/126.ddc4474b.js"><link rel="prefetch" href="/assets/js/127.77536101.js"><link rel="prefetch" href="/assets/js/128.5dd52fc7.js"><link rel="prefetch" href="/assets/js/129.6c99a810.js"><link rel="prefetch" href="/assets/js/13.8bf0f23e.js"><link rel="prefetch" href="/assets/js/130.faa12e2e.js"><link rel="prefetch" href="/assets/js/131.ff600709.js"><link rel="prefetch" href="/assets/js/132.8d824641.js"><link rel="prefetch" href="/assets/js/133.c26af601.js"><link rel="prefetch" href="/assets/js/134.c932e5ca.js"><link rel="prefetch" href="/assets/js/135.1a11d73e.js"><link rel="prefetch" href="/assets/js/136.39cbc21a.js"><link rel="prefetch" href="/assets/js/137.21b966f9.js"><link rel="prefetch" href="/assets/js/138.9248d545.js"><link rel="prefetch" href="/assets/js/139.a304bb6f.js"><link rel="prefetch" href="/assets/js/14.b897aaa9.js"><link rel="prefetch" href="/assets/js/140.4f8b455e.js"><link rel="prefetch" href="/assets/js/141.d6ddbdd1.js"><link rel="prefetch" href="/assets/js/142.9d701fd3.js"><link rel="prefetch" href="/assets/js/143.4fedc479.js"><link rel="prefetch" href="/assets/js/144.0d30d704.js"><link rel="prefetch" href="/assets/js/145.47c48ec2.js"><link rel="prefetch" href="/assets/js/146.da2c710e.js"><link rel="prefetch" href="/assets/js/147.b69eceaa.js"><link rel="prefetch" href="/assets/js/148.6dce1a86.js"><link rel="prefetch" href="/assets/js/149.905b3fea.js"><link rel="prefetch" href="/assets/js/15.296f2506.js"><link rel="prefetch" href="/assets/js/150.609e2610.js"><link rel="prefetch" href="/assets/js/151.e4daa07f.js"><link rel="prefetch" href="/assets/js/152.96960b84.js"><link rel="prefetch" href="/assets/js/153.8b026a84.js"><link rel="prefetch" href="/assets/js/154.535d9002.js"><link rel="prefetch" href="/assets/js/155.d131882f.js"><link rel="prefetch" href="/assets/js/156.92594355.js"><link rel="prefetch" href="/assets/js/157.177b171c.js"><link rel="prefetch" href="/assets/js/158.ab8e722b.js"><link rel="prefetch" href="/assets/js/159.0b52ad96.js"><link rel="prefetch" href="/assets/js/16.adccd4e8.js"><link rel="prefetch" href="/assets/js/160.b3a57bd7.js"><link rel="prefetch" href="/assets/js/161.19741734.js"><link rel="prefetch" href="/assets/js/162.bf246d2a.js"><link rel="prefetch" href="/assets/js/163.17cf9d0d.js"><link rel="prefetch" href="/assets/js/164.e9a5db3b.js"><link rel="prefetch" href="/assets/js/165.7a695acf.js"><link rel="prefetch" href="/assets/js/166.e567e23a.js"><link rel="prefetch" href="/assets/js/167.49861f38.js"><link rel="prefetch" href="/assets/js/168.6f8b5b89.js"><link rel="prefetch" href="/assets/js/17.85c3c1f1.js"><link rel="prefetch" href="/assets/js/18.53360c2c.js"><link rel="prefetch" href="/assets/js/19.03f35ec0.js"><link rel="prefetch" href="/assets/js/20.f729ad0e.js"><link rel="prefetch" href="/assets/js/21.04d5ff0d.js"><link rel="prefetch" href="/assets/js/22.be6c32fa.js"><link rel="prefetch" href="/assets/js/23.efc1c82b.js"><link rel="prefetch" href="/assets/js/24.12a32996.js"><link rel="prefetch" href="/assets/js/25.bddeb4c3.js"><link rel="prefetch" href="/assets/js/26.85161e49.js"><link rel="prefetch" href="/assets/js/27.95bc6c7b.js"><link rel="prefetch" href="/assets/js/28.4ed8117b.js"><link rel="prefetch" href="/assets/js/29.e1c9da66.js"><link rel="prefetch" href="/assets/js/30.488c2a55.js"><link rel="prefetch" href="/assets/js/31.22627d31.js"><link rel="prefetch" href="/assets/js/32.0a1c75b8.js"><link rel="prefetch" href="/assets/js/33.2b56409c.js"><link rel="prefetch" href="/assets/js/34.949f2f08.js"><link rel="prefetch" href="/assets/js/35.30b31a5f.js"><link rel="prefetch" href="/assets/js/36.725999db.js"><link rel="prefetch" href="/assets/js/38.a9bc1b6b.js"><link rel="prefetch" href="/assets/js/39.d83c0fdc.js"><link rel="prefetch" href="/assets/js/4.8191bfff.js"><link rel="prefetch" href="/assets/js/40.67b3ecf0.js"><link rel="prefetch" href="/assets/js/41.ca6c692b.js"><link rel="prefetch" href="/assets/js/42.8104214f.js"><link rel="prefetch" href="/assets/js/43.de53e242.js"><link rel="prefetch" href="/assets/js/44.ba235ee4.js"><link rel="prefetch" href="/assets/js/45.3114f8ea.js"><link rel="prefetch" href="/assets/js/46.be28e80a.js"><link rel="prefetch" href="/assets/js/47.540c8a33.js"><link rel="prefetch" href="/assets/js/48.16f0bcb2.js"><link rel="prefetch" href="/assets/js/49.62e71c16.js"><link rel="prefetch" href="/assets/js/5.599e6a7c.js"><link rel="prefetch" href="/assets/js/50.d7b6a73f.js"><link rel="prefetch" href="/assets/js/51.cd1681d8.js"><link rel="prefetch" href="/assets/js/52.912b7eb4.js"><link rel="prefetch" href="/assets/js/53.f63cbbaa.js"><link rel="prefetch" href="/assets/js/54.a0272657.js"><link rel="prefetch" href="/assets/js/55.304f3a6c.js"><link rel="prefetch" href="/assets/js/56.87f1f07e.js"><link rel="prefetch" href="/assets/js/57.bd29545b.js"><link rel="prefetch" href="/assets/js/58.71aa225e.js"><link rel="prefetch" href="/assets/js/59.de4b1bce.js"><link rel="prefetch" href="/assets/js/6.86af36b9.js"><link rel="prefetch" href="/assets/js/60.a96f7f49.js"><link rel="prefetch" href="/assets/js/61.fdf4d890.js"><link rel="prefetch" href="/assets/js/62.a46c4e4e.js"><link rel="prefetch" href="/assets/js/63.8b996549.js"><link rel="prefetch" href="/assets/js/64.7dbbcad1.js"><link rel="prefetch" href="/assets/js/65.fd2081e5.js"><link rel="prefetch" href="/assets/js/66.98915198.js"><link rel="prefetch" href="/assets/js/67.702c35c3.js"><link rel="prefetch" href="/assets/js/68.dc4a8d40.js"><link rel="prefetch" href="/assets/js/69.71fdb01b.js"><link rel="prefetch" href="/assets/js/7.096060b8.js"><link rel="prefetch" href="/assets/js/70.0d08616b.js"><link rel="prefetch" href="/assets/js/71.63f0a6b5.js"><link rel="prefetch" href="/assets/js/72.bbd78022.js"><link rel="prefetch" href="/assets/js/73.51adbfa1.js"><link rel="prefetch" href="/assets/js/74.98e47b95.js"><link rel="prefetch" href="/assets/js/75.5b3939ab.js"><link rel="prefetch" href="/assets/js/76.2e50b5f0.js"><link rel="prefetch" href="/assets/js/77.ccfd5f23.js"><link rel="prefetch" href="/assets/js/78.8abc56aa.js"><link rel="prefetch" href="/assets/js/79.c299f8de.js"><link rel="prefetch" href="/assets/js/8.b737c7b7.js"><link rel="prefetch" href="/assets/js/80.ccaa0b39.js"><link rel="prefetch" href="/assets/js/81.a7229866.js"><link rel="prefetch" href="/assets/js/82.487e273f.js"><link rel="prefetch" href="/assets/js/83.e4cbe993.js"><link rel="prefetch" href="/assets/js/84.f2ca382d.js"><link rel="prefetch" href="/assets/js/85.7012d877.js"><link rel="prefetch" href="/assets/js/86.5f31ac47.js"><link rel="prefetch" href="/assets/js/87.7387ff31.js"><link rel="prefetch" href="/assets/js/88.d992463d.js"><link rel="prefetch" href="/assets/js/89.014bfaf2.js"><link rel="prefetch" href="/assets/js/9.e7dfcdd2.js"><link rel="prefetch" href="/assets/js/90.496afa55.js"><link rel="prefetch" href="/assets/js/91.71f14531.js"><link rel="prefetch" href="/assets/js/92.7761c13e.js"><link rel="prefetch" href="/assets/js/93.60a806d9.js"><link rel="prefetch" href="/assets/js/94.d22093c0.js"><link rel="prefetch" href="/assets/js/95.a1d7fcb2.js"><link rel="prefetch" href="/assets/js/96.af12f65e.js"><link rel="prefetch" href="/assets/js/97.1f5d834b.js"><link rel="prefetch" href="/assets/js/98.e57ea119.js"><link rel="prefetch" href="/assets/js/99.c11b5ac6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4b97fc91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b0a18694.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/quick-starts/" class="sidebar-heading clickable open"><span>Quick Starts</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/quick-starts/in-memory.html" class="sidebar-link">In Memory</a></li><li><a href="/quick-starts/rabbitmq.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/quick-starts/azure-service-bus.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/quick-starts/sqs.html" class="sidebar-link">SQS</a></li></ul></section></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/templates.html" class="sidebar-link">Templates</a></li><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/faas/" class="sidebar-heading clickable"><span>FaaS</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/guidance.html" class="sidebar-link">Guidance</a></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/advanced/scheduling/" class="sidebar-heading clickable open"><span>Scheduling</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced/scheduling/scheduling-api.html" class="sidebar-link">Schedule Messages</a></li><li><a href="/advanced/scheduling/activemq-delayed.html" class="sidebar-link">ActiveMQ</a></li><li><a href="/advanced/scheduling/amazonsqs-scheduler.html" class="sidebar-link">Amazon SQS</a></li><li><a href="/advanced/scheduling/azure-sb-scheduler.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/advanced/scheduling/rabbitmq-delayed.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/advanced/scheduling/hangfire.html" class="sidebar-link">Hangfire Scheduler</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/advanced/courier/" class="sidebar-heading clickable"><span>Courier</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/advanced/middleware/" class="sidebar-heading clickable"><span>Middleware</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/advanced/transactional-outbox.html" class="sidebar-link">Transactional Outbox</a></li><li><a href="/usage/message-data.html" class="sidebar-link">Message Data</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Monitoring</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/advanced/connect-endpoint.html" class="sidebar-link">Connect Endpoint</a></li><li><a href="/advanced/observers.html" aria-current="page" class="active sidebar-link">Observers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced/observers.html#receive" class="sidebar-link">Receive</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#consume" class="sidebar-link">Consume</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#send" class="sidebar-link">Send</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#publish" class="sidebar-link">Publish</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#bus" class="sidebar-link">Bus</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#receive-endpoint" class="sidebar-link">Receive Endpoint</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#state-machine-event" class="sidebar-link">State Machine Event</a></li><li class="sidebar-sub-header"><a href="/advanced/observers.html#state-machine-state" class="sidebar-link">State Machine State</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/advanced/topology/" class="sidebar-heading clickable"><span>Topology</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/advanced/signalr/" class="sidebar-heading clickable"><span>SignalR</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/advanced/audit.html" class="sidebar-link">Message Audit</a></li><li><a href="/advanced/batching.html" class="sidebar-link">Batching</a></li><li><a href="/advanced/job-consumers.html" class="sidebar-link">Job Consumers</a></li></ul></section></li></ul></section></li><li><a href="/support.html" class="sidebar-link">Support</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="observers"><a href="#observers" class="header-anchor">#</a> Observers</h1> <p>MassTransit supports several message observers allowing received, consumed, sent, and published messages to be monitored. There is a bus observer as well, so that the bus life cycle can be monitored.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Observers should not be used to modify or intercept messages. To intercept messages to add headers or modify message content, create a new or use an existing middleware component.</p></div> <h2 id="receive"><a href="#receive" class="header-anchor">#</a> Receive</h2> <p>To observe messages as they are received by the transport, create a class that implements the <code>IReceiveObserver</code> interface, and connect it to the bus as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// An observer that can monitor a receive endpoint to track message consumption at the</span>
    <span class="token comment">/// endpoint level.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IReceiveObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when a message has been delivered by the transport is about to be received by the endpoint</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The receive context of the message&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PreReceive</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the message has been received and acknowledged on the transport</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The receive context of the message&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PostReceive</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when a message has been consumed by a consumer</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message consume context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;duration&quot;&gt;The consumer duration&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;consumerType&quot;&gt;The consumer type&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PostConsume</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> duration<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> consumerType<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when a message being consumed produced a fault</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message consume context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;duration&quot;&gt;The consumer duration&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;consumerType&quot;&gt;The consumer type&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception from the consumer&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">ConsumeFault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> duration<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> consumerType<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the transport receive faults</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The receive context of the message&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception that was thrown&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">ReceiveFault</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a receive observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer creation. When a container is not being used, the <code>ConnectReceiveObserver</code> bus method can be used instead.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddReceiveObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ReceiveObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddReceiveObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ReceiveObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="consume"><a href="#consume" class="header-anchor">#</a> Consume</h2> <p>If the <code>ReceiveContext</code> isn't fascinating enough for you, perhaps the actual consumption of messages might float your boat. A consume observer implements the <code>IConsumeObserver</code> interface, as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Intercepts the ConsumeContext</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IConsumeObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before a message is dispatched to any consumers</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The consume context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PreConsume</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message has been dispatched to all consumers - note that in the case of an exception</span>
        <span class="token comment">/// this method is not called, and the DispatchFaulted method is called instead</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PostConsume</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message has been dispatched to all consumers when one or more exceptions have occurred</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">ConsumeFault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a consume observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer creation. When a container is not being used, the <code>ConnectConsumeObserver</code> bus method can be used instead.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumeObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ConsumeObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddConsumeObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConsumeObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="consume-message"><a href="#consume-message" class="header-anchor">#</a> Consume Message</h3> <p>Okay, so it's obvious that if you've read this far you want a more specific observer, one that only is called when a specific message type is consumed. We have you covered there too, as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Intercepts the ConsumeContext</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IConsumeMessageObserver<span class="token punctuation">&lt;</span><span class="token keyword">in</span> T<span class="token punctuation">&gt;</span></span>
        <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before a message is dispatched to any consumers</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The consume context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PreConsume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message has been dispatched to all consumers - note that in the case of an exception</span>
        <span class="token comment">/// this method is not called, and the DispatchFaulted method is called instead</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PostConsume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message has been dispatched to all consumers when one or more exceptions have occurred</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">ConsumeFault</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To connect the observer, use the <code>ConnectConsumeMessageObserver</code> method before starting the bus.</p> <blockquote><p>The <code>ConsumeObserver&lt;T&gt;</code> interface may be deprecated at some point, it's sort of a legacy observer that isn't recommended.</p></blockquote> <h2 id="send"><a href="#send" class="header-anchor">#</a> Send</h2> <p>Okay, so, incoming messages are not your thing. We get it, you're all about what goes out. It's cool. It's better to send than to receive. Or is that give? Anyway, a send observer is also available.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Observes messages as they are sent to transports. These should not be used to intercept or</span>
    <span class="token comment">/// filter messages, in that case a filter should be created and registered on the transport.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISendObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before the message is sent to the transport</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PreSend</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">SendContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message is sent to the transport (and confirmed by the transport if supported)</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PostSend</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">SendContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the message fails to send to the transport, including the exception that was thrown</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception from the transport&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">SendFault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">SendContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a send observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer
creation. When a container is not being used, the <code>ConnectSendObserver</code> bus method can be used instead.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSendObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddSendObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SendObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="publish"><a href="#publish" class="header-anchor">#</a> Publish</h2> <p>In addition to send, publish is also observable. Because the semantics matter, absolutely. Using the MessageId to link them up as it's unique for each message. Remember that Publish and Send are two distinct operations so if you want to observe all messages that are leaving your service, you have to connect both Publish and Send observers.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Observes messages as they are published via a publish endpoint. These should not be used to intercept or</span>
    <span class="token comment">/// filter messages, in that case a filter should be created and registered on the transport.</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPublishObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before the message is sent to the transport</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PrePublish</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">PublishContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the message is sent to the transport (and confirmed by the transport if supported)</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PostPublish</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">PublishContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the message fails to send to the transport, including the exception that was thrown</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The message send context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception from the transport&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PublishFault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">PublishContext<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a public observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer
creation. When a container is not being used, the <code>ConnectPublishObserver</code> bus method can be used instead.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddPublishObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PublishObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddPublishObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PublishObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="bus"><a href="#bus" class="header-anchor">#</a> Bus</h2> <p>To observe bus life cycle events, create a class which implements <code>IBusObserver</code>, as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Used to observe events produced by the bus</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBusObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called after the bus has been created.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PostCreate</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus fails to be created</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateFaulted</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus is being started, before the actual Start commences.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PreStart</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called once the bus has started and is running</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;busReady&quot;&gt;</span>
        <span class="token comment">/// A task which is completed once the bus is ready and all receive endpoints are ready.</span>
        <span class="token comment">/// &lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PostStart</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">,</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span>BusReady<span class="token punctuation">&gt;</span></span> busReady<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus fails to start</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">StartFaulted</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus is being stopped, before the actual Stop commences.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PreStop</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus has been stopped.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PostStop</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the bus failed to Stop.</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;bus&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">StopFaulted</span><span class="token punctuation">(</span><span class="token class-name">IBus</span> bus<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a bus observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer creation.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddBusObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BusObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddBusObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BusObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="receive-endpoint"><a href="#receive-endpoint" class="header-anchor">#</a> Receive Endpoint</h2> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Used to observe the events signaled by a receive endpoint</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IReceiveEndpointObserver</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the receive endpoint is ready to receive messages</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;ready&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">Ready</span><span class="token punctuation">(</span><span class="token class-name">ReceiveEndpointReady</span> ready<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the receive endpoint is being stopped, prior to actually stopping</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;stopping&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">Stopping</span><span class="token punctuation">(</span><span class="token class-name">ReceiveEndpointStopping</span> stopping<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the receive endpoint has completed</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;completed&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">Completed</span><span class="token punctuation">(</span><span class="token class-name">ReceiveEndpointCompleted</span> completed<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the receive endpoint faults</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;faulted&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">Faulted</span><span class="token punctuation">(</span><span class="token class-name">ReceiveEndpointFaulted</span> faulted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a receive endpoint observer, add it to the container using one of the methods shown below. The factory method version allows customization of the observer creation.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddReceiveEndpointObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ReceiveEndpointObserver<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddReceiveEndpointObserver</span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ReceiveEndpointObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="state-machine-event"><a href="#state-machine-event" class="header-anchor">#</a> State Machine Event</h2> <p>To observe events consumed by a saga state machine, use an <code>IEventObserver&lt;T&gt;</code> where <code>T</code> is the saga instance type.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IEventObserver<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span>
        <span class="token keyword">where</span> <span class="token class-name">TSaga</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ISaga</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before the event context is delivered to the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PreExecute</span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called before the event context is delivered to the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The event data type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PreExecute</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the event has been processed by the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">PostExecute</span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the event has been processed by the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The event data type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">PostExecute</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the activity execution faults and is not handled by the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception that was thrown&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">ExecuteFault</span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Called when the activity execution faults and is not handled by the activities</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;The message type&lt;/typeparam&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The event context&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;exception&quot;&gt;The exception that was thrown&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">ExecuteFault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">,</span> T<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
            <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure an event observer, add it to the container using one of the methods shown below. The factory method version allows customization of the
observer creation.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEventObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> EventObserver<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEventObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventObserver<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="state-machine-state"><a href="#state-machine-state" class="header-anchor">#</a> State Machine State</h2> <p>To observe state changes that happen in a saga state machine, use an <code>IStateObserver&lt;T&gt;</code> where <code>T</code> is the saga instance type.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MassTransit</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStateObserver<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span>
        <span class="token keyword">where</span> <span class="token class-name">TSaga</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ISaga</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Invoked prior to changing the state of the state machine</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;context&quot;&gt;The instance context of the state machine&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;currentState&quot;&gt;The current state (after the change)&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;previousState&quot;&gt;The previous state (before the change)&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token return-type class-name">Task</span> <span class="token function">StateChanged</span><span class="token punctuation">(</span><span class="token class-name">BehaviorContext<span class="token punctuation">&lt;</span>TSaga<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">State</span> currentState<span class="token punctuation">,</span> <span class="token class-name">State</span> previousState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure a state observer, add it to the container using one of the methods shown below. The factory method version allows customization of the
observer creation.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddStateObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> StateObserver<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddStateObserver</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>provider <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StateObserver<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/advanced/observers.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/29/2023, 4:08:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/advanced/connect-endpoint.html" class="prev">
        Connect Endpoint
      </a></span> <span class="next"><a href="/advanced/topology/message.html">
        Message Topology
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f6b98727.js" defer></script><script src="/assets/js/3.5d941158.js" defer></script><script src="/assets/js/37.f96e32d8.js" defer></script>
  </body>
</html>
