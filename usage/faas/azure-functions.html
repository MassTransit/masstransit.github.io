<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Azure Functions | MassTransit</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.af8ca635.css" as="style"><link rel="preload" href="/assets/js/app.0f717998.js" as="script"><link rel="preload" href="/assets/js/3.da322882.js" as="script"><link rel="preload" href="/assets/js/123.f7ca23b1.js" as="script"><link rel="prefetch" href="/assets/js/10.941c3d0b.js"><link rel="prefetch" href="/assets/js/100.23f1c4ea.js"><link rel="prefetch" href="/assets/js/101.710aa7a5.js"><link rel="prefetch" href="/assets/js/102.827dba0e.js"><link rel="prefetch" href="/assets/js/103.fdd173f3.js"><link rel="prefetch" href="/assets/js/104.8c1a005f.js"><link rel="prefetch" href="/assets/js/105.95990127.js"><link rel="prefetch" href="/assets/js/106.c4b2015b.js"><link rel="prefetch" href="/assets/js/107.e0acc6f2.js"><link rel="prefetch" href="/assets/js/108.78eab687.js"><link rel="prefetch" href="/assets/js/109.b4d1a487.js"><link rel="prefetch" href="/assets/js/11.76406285.js"><link rel="prefetch" href="/assets/js/110.f0a83b63.js"><link rel="prefetch" href="/assets/js/111.3f22952e.js"><link rel="prefetch" href="/assets/js/112.1ad12ad5.js"><link rel="prefetch" href="/assets/js/113.40368044.js"><link rel="prefetch" href="/assets/js/114.3cd980b4.js"><link rel="prefetch" href="/assets/js/115.00f2166d.js"><link rel="prefetch" href="/assets/js/116.6670b5f2.js"><link rel="prefetch" href="/assets/js/117.4a42c861.js"><link rel="prefetch" href="/assets/js/118.e6410316.js"><link rel="prefetch" href="/assets/js/119.dd058ee6.js"><link rel="prefetch" href="/assets/js/12.4464da33.js"><link rel="prefetch" href="/assets/js/120.cccb363a.js"><link rel="prefetch" href="/assets/js/121.75e3ed75.js"><link rel="prefetch" href="/assets/js/122.ddb3d7e5.js"><link rel="prefetch" href="/assets/js/124.2e501680.js"><link rel="prefetch" href="/assets/js/125.4d5eeb88.js"><link rel="prefetch" href="/assets/js/126.6c0ed471.js"><link rel="prefetch" href="/assets/js/127.6d232467.js"><link rel="prefetch" href="/assets/js/128.7a780f23.js"><link rel="prefetch" href="/assets/js/129.7fda41f1.js"><link rel="prefetch" href="/assets/js/13.512e3537.js"><link rel="prefetch" href="/assets/js/130.19738da2.js"><link rel="prefetch" href="/assets/js/131.6e3916b7.js"><link rel="prefetch" href="/assets/js/132.bdf944d1.js"><link rel="prefetch" href="/assets/js/133.bf0cdaf4.js"><link rel="prefetch" href="/assets/js/134.a24e70f8.js"><link rel="prefetch" href="/assets/js/135.3087f6fe.js"><link rel="prefetch" href="/assets/js/136.c0914ec3.js"><link rel="prefetch" href="/assets/js/137.adc2c79a.js"><link rel="prefetch" href="/assets/js/138.6300f157.js"><link rel="prefetch" href="/assets/js/139.b2f14afc.js"><link rel="prefetch" href="/assets/js/14.f3f541c4.js"><link rel="prefetch" href="/assets/js/140.66174436.js"><link rel="prefetch" href="/assets/js/141.548ac70e.js"><link rel="prefetch" href="/assets/js/142.31e46e2f.js"><link rel="prefetch" href="/assets/js/143.e450e37e.js"><link rel="prefetch" href="/assets/js/144.1a7bdf49.js"><link rel="prefetch" href="/assets/js/145.8bd22f33.js"><link rel="prefetch" href="/assets/js/146.e9cae417.js"><link rel="prefetch" href="/assets/js/147.99c43782.js"><link rel="prefetch" href="/assets/js/148.0001e2e5.js"><link rel="prefetch" href="/assets/js/149.8dd98593.js"><link rel="prefetch" href="/assets/js/15.5b1e58a2.js"><link rel="prefetch" href="/assets/js/150.576d606c.js"><link rel="prefetch" href="/assets/js/151.7ffc60f8.js"><link rel="prefetch" href="/assets/js/152.64603d5f.js"><link rel="prefetch" href="/assets/js/153.04273ceb.js"><link rel="prefetch" href="/assets/js/154.5ecb1789.js"><link rel="prefetch" href="/assets/js/155.2443a17f.js"><link rel="prefetch" href="/assets/js/156.89bc3ef2.js"><link rel="prefetch" href="/assets/js/157.d2092780.js"><link rel="prefetch" href="/assets/js/158.abc54fe2.js"><link rel="prefetch" href="/assets/js/159.f591dba4.js"><link rel="prefetch" href="/assets/js/16.b89c7882.js"><link rel="prefetch" href="/assets/js/17.8a846d9a.js"><link rel="prefetch" href="/assets/js/18.bd1ec876.js"><link rel="prefetch" href="/assets/js/19.00d1434f.js"><link rel="prefetch" href="/assets/js/20.384b5b5b.js"><link rel="prefetch" href="/assets/js/21.b1ed6e3f.js"><link rel="prefetch" href="/assets/js/22.f8fa29a7.js"><link rel="prefetch" href="/assets/js/23.d5d8e28e.js"><link rel="prefetch" href="/assets/js/24.0e4be943.js"><link rel="prefetch" href="/assets/js/25.d7ae1021.js"><link rel="prefetch" href="/assets/js/26.d7c52843.js"><link rel="prefetch" href="/assets/js/27.b8504be5.js"><link rel="prefetch" href="/assets/js/28.318c6322.js"><link rel="prefetch" href="/assets/js/29.eb49e807.js"><link rel="prefetch" href="/assets/js/30.9ff31a8a.js"><link rel="prefetch" href="/assets/js/31.f9836bae.js"><link rel="prefetch" href="/assets/js/32.4306b1f2.js"><link rel="prefetch" href="/assets/js/33.3cbf102a.js"><link rel="prefetch" href="/assets/js/34.82ea42b8.js"><link rel="prefetch" href="/assets/js/35.a4cf4586.js"><link rel="prefetch" href="/assets/js/36.c79bc776.js"><link rel="prefetch" href="/assets/js/37.93848c0f.js"><link rel="prefetch" href="/assets/js/38.aed8b2f5.js"><link rel="prefetch" href="/assets/js/39.0bd57e5e.js"><link rel="prefetch" href="/assets/js/4.37ee6b06.js"><link rel="prefetch" href="/assets/js/40.8a1415b1.js"><link rel="prefetch" href="/assets/js/41.d49c2efb.js"><link rel="prefetch" href="/assets/js/42.b7bbbaf6.js"><link rel="prefetch" href="/assets/js/43.87609deb.js"><link rel="prefetch" href="/assets/js/44.cee9abc3.js"><link rel="prefetch" href="/assets/js/45.55c4b4b6.js"><link rel="prefetch" href="/assets/js/46.fc3df9fc.js"><link rel="prefetch" href="/assets/js/47.126380a2.js"><link rel="prefetch" href="/assets/js/48.345456c9.js"><link rel="prefetch" href="/assets/js/49.cb212764.js"><link rel="prefetch" href="/assets/js/5.9fe86136.js"><link rel="prefetch" href="/assets/js/50.e2a625b8.js"><link rel="prefetch" href="/assets/js/51.a2301d85.js"><link rel="prefetch" href="/assets/js/52.7626f76b.js"><link rel="prefetch" href="/assets/js/53.6dcfb078.js"><link rel="prefetch" href="/assets/js/54.7d5b7906.js"><link rel="prefetch" href="/assets/js/55.2f161720.js"><link rel="prefetch" href="/assets/js/56.3baf6838.js"><link rel="prefetch" href="/assets/js/57.5952a2e8.js"><link rel="prefetch" href="/assets/js/58.35bd50d1.js"><link rel="prefetch" href="/assets/js/59.1a61c98b.js"><link rel="prefetch" href="/assets/js/6.ae895e4f.js"><link rel="prefetch" href="/assets/js/60.dde8f8f2.js"><link rel="prefetch" href="/assets/js/61.fc9b4fc0.js"><link rel="prefetch" href="/assets/js/62.a5b28645.js"><link rel="prefetch" href="/assets/js/63.16221e1a.js"><link rel="prefetch" href="/assets/js/64.573d11a6.js"><link rel="prefetch" href="/assets/js/65.0082a727.js"><link rel="prefetch" href="/assets/js/66.366ffe6e.js"><link rel="prefetch" href="/assets/js/67.2271d873.js"><link rel="prefetch" href="/assets/js/68.6cfc25bd.js"><link rel="prefetch" href="/assets/js/69.f91f0dae.js"><link rel="prefetch" href="/assets/js/7.77650bb5.js"><link rel="prefetch" href="/assets/js/70.9f842d94.js"><link rel="prefetch" href="/assets/js/71.f12cfc74.js"><link rel="prefetch" href="/assets/js/72.7c699f2b.js"><link rel="prefetch" href="/assets/js/73.2080b9dd.js"><link rel="prefetch" href="/assets/js/74.03ec3239.js"><link rel="prefetch" href="/assets/js/75.a2e95397.js"><link rel="prefetch" href="/assets/js/76.a8f91599.js"><link rel="prefetch" href="/assets/js/77.bb549269.js"><link rel="prefetch" href="/assets/js/78.56c8d184.js"><link rel="prefetch" href="/assets/js/79.99f38c6f.js"><link rel="prefetch" href="/assets/js/8.be925209.js"><link rel="prefetch" href="/assets/js/80.13f11752.js"><link rel="prefetch" href="/assets/js/81.028a7b5e.js"><link rel="prefetch" href="/assets/js/82.4956e61b.js"><link rel="prefetch" href="/assets/js/83.4efd0d82.js"><link rel="prefetch" href="/assets/js/84.e214e198.js"><link rel="prefetch" href="/assets/js/85.c935478c.js"><link rel="prefetch" href="/assets/js/86.bd6a9d11.js"><link rel="prefetch" href="/assets/js/87.47bd24e2.js"><link rel="prefetch" href="/assets/js/88.350bbf5d.js"><link rel="prefetch" href="/assets/js/89.32d2e3c2.js"><link rel="prefetch" href="/assets/js/9.b8c411bf.js"><link rel="prefetch" href="/assets/js/90.e0e9e669.js"><link rel="prefetch" href="/assets/js/91.a2c133e3.js"><link rel="prefetch" href="/assets/js/92.00ca9d52.js"><link rel="prefetch" href="/assets/js/93.70dcdd49.js"><link rel="prefetch" href="/assets/js/94.861c48fb.js"><link rel="prefetch" href="/assets/js/95.352fd642.js"><link rel="prefetch" href="/assets/js/96.e303cfc4.js"><link rel="prefetch" href="/assets/js/97.b5c87e83.js"><link rel="prefetch" href="/assets/js/98.1d3e5253.js"><link rel="prefetch" href="/assets/js/99.a0f7babd.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.ceb48f17.js">
    <link rel="stylesheet" href="/assets/css/0.styles.af8ca635.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/faas/" class="sidebar-heading clickable router-link-active open"><span>FaaS</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/faas/azure-functions.html" aria-current="page" class="active sidebar-link">Azure Functions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/usage/faas/aws-lambda.html" class="sidebar-link">AWS Lambda</a></li></ul></section></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="azure-functions"><a href="#azure-functions" class="header-anchor">#</a> Azure Functions</h1> <p>Azure Functions is a consumption-based compute solution that only runs code when there is work to be done. MassTransit supports Azure Service Bus and Azure Event Hubs when running as an Azure Function.</p> <blockquote><p>The <a href="https://github.com/MassTransit/Sample-AzureFunction" target="_blank" rel="noopener noreferrer">Sample Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is available for reference as well, which is based on the 8.0.0 version of MassTransit.</p></blockquote> <p>The functions <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-service-bus-trigger?tabs=csharp" target="_blank" rel="noopener noreferrer">host.json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> file needs to have messageHandlerOptions &gt; autoComplete set to true. If this isn't set to true, MassTransit will <em>try</em> to set it to true for you. This is so that the message is acknowledged by the Azure Functions runtime, which removes it from the queue once processing has completed successfully.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;applicationInsights&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;samplingSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;isEnabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;MassTransit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Debug&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Sample.AzureFunctions.ServiceBus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;extensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serviceBus&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;prefetchCount&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
      <span class="token property">&quot;messageHandlerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;autoComplete&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maxConcurrentCalls&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
        <span class="token property">&quot;maxAutoRenewDuration&quot;</span><span class="token operator">:</span> <span class="token string">&quot;00:30:00&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eventHub&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;maxBatchSize&quot;</span><span class="token operator">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
      <span class="token property">&quot;prefetchCount&quot;</span><span class="token operator">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      <span class="token property">&quot;batchCheckpointFrequency&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This settings for <em>prefetchCount</em>, <em>maxConcurrentCalls</em>, and <em>maxAutoRenewDuration</em> are the most important – these will directly affect the performance of an Azure Function.</p> <p>The function should include a Startup class, which is called on startup by the Azure Functions framework. The example below configures MassTransit, registers the consumers for use, and adds a scoped type for an Azure function class.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>Functions<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">FunctionsStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Sample<span class="token punctuation">.</span>AzureFunctions<span class="token punctuation">.</span>ServiceBus<span class="token punctuation">.</span>Startup</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">Sample<span class="token punctuation">.</span>AzureFunctions<span class="token punctuation">.</span>ServiceBus</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span> <span class="token punctuation">:</span>
        <span class="token type-list"><span class="token class-name">FunctionsStartup</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IFunctionsHostBuilder</span> builder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span>Services
                <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderFunctions<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// add your functions as scoped</span>
                <span class="token punctuation">.</span><span class="token function">AddMassTransitForAzureFunctions</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumersFromNamespaceContaining</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ConsumerNamespace<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Azure Functions using Azure Service Bus or Azure Event Hubs require the queue, subscription, topic, or event hub to exist prior to starting the function service. If the messaging entity does not exist, the function will not be bound, and messages or events will not be delivered. Service Bus messages sent or published by MassTransit running inside an Azure Function will, however, create the appropriate topics and/or queues as needed.</p></div> <h3 id="azure-service-bus"><a href="#azure-service-bus" class="header-anchor">#</a> Azure Service Bus</h3> <p>The bindings for using MassTransit with Azure Service Bus are shown below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">MassTransit<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>ServiceBusIntegration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>ServiceBus</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubmitOrderFunctions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> SubmitOrderQueueName <span class="token operator">=</span> <span class="token string">&quot;input-queue&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">readonly</span> <span class="token class-name">IMessageReceiver</span> _receiver<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">SubmitOrderFunctions</span><span class="token punctuation">(</span><span class="token class-name">IMessageReceiver</span> receiver<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FunctionName</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;SubmitOrder&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">SubmitOrderAsync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ServiceBusTrigger</span><span class="token attribute-arguments"><span class="token punctuation">(</span>SubmitOrderQueueName<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _receiver<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">HandleConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>SubmitOrderQueueName<span class="token punctuation">,</span> message<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the example above, the <em>HandleConsumer</em> method is used to configure a specific consumer on the message receiver.</p> <blockquote><p>Message receivers are cached by <em>entityName</em>. Once a message receiver has been used, the configuration cannot be changed.</p></blockquote> <p>To configure the consumer pipeline, such as to add <code>UseMessageRetry</code> middleware, use a <code>ConsumerDefinition</code> for the consumer type.</p> <h3 id="event-hub"><a href="#event-hub" class="header-anchor">#</a> Event Hub</h3> <p>The bindings for using MassTransit with Azure Event Hub are shown below. In addition to the event hub name, the <em>Connection</em> must also be specified.</p> <blockquote><p>At least I think so, the documentation isn't great and I only found this approach when digging through the extension source code.</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">MassTransit<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>EventHubsIntegration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>EventHubs</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuditOrderFunctions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> AuditOrderEventHubName <span class="token operator">=</span> <span class="token string">&quot;input-hub&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">readonly</span> <span class="token class-name">IEventReceiver</span> _receiver<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AuditOrderFunctions</span><span class="token punctuation">(</span><span class="token class-name">IEventReceiver</span> receiver<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _receiver <span class="token operator">=</span> receiver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FunctionName</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;AuditOrder&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">AuditOrderAsync</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EventHubTrigger</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AuditOrderEventHubName<span class="token punctuation">,</span> Connection <span class="token operator">=</span> <span class="token string">&quot;AzureWebJobsEventHub&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token class-name">EventData</span> message<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _receiver<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">HandleConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AuditOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>AuditOrderEventHubName<span class="token punctuation">,</span> message<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>With this refresh of the Azure Function code, it is no longer possible to send messages to other event hubs. Messages published or sent are done so using Azure Service Bus.</p></div> <h3 id="testing-locally"><a href="#testing-locally" class="header-anchor">#</a> Testing Locally</h3> <p>To test locally, a settings files must be created. Connections strings for the various services, along with the Application Insights connection string, can be configured.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;IsEncrypted&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;Values&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;FUNCTIONS_WORKER_RUNTIME&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dotnet&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;AzureWebJobsStorage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;AzureWebJobsServiceBus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;AzureWebJobsEventHub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;FUNCTIONS_EXTENSION_VERSION&quot;</span><span class="token operator">:</span> <span class="token string">&quot;~3&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;APPINSIGHTS_INSTRUMENTATIONKEY&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;APPLICATIONINSIGHTS_CONNECTION_STRING&quot;</span><span class="token operator">:</span> <span class="token string">&quot;InstrumentationKey=&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/faas/azure-functions.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/24/2022, 7:10:01 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/usage/riders/eventhub.html" class="prev">
        Event Hub
      </a></span> <span class="next"><a href="/usage/faas/aws-lambda.html">
        AWS Lambda
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0f717998.js" defer></script><script src="/assets/js/3.da322882.js" defer></script><script src="/assets/js/123.f7ca23b1.js" defer></script>
  </body>
</html>
