<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Configuration | MassTransit</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.b0a18694.css" as="style"><link rel="preload" href="/assets/js/app.f6b98727.js" as="script"><link rel="preload" href="/assets/js/3.5d941158.js" as="script"><link rel="preload" href="/assets/js/117.e885181b.js" as="script"><link rel="prefetch" href="/assets/js/10.49f30773.js"><link rel="prefetch" href="/assets/js/100.243463e8.js"><link rel="prefetch" href="/assets/js/101.6c574e04.js"><link rel="prefetch" href="/assets/js/102.3f8ecb5a.js"><link rel="prefetch" href="/assets/js/103.102e0b62.js"><link rel="prefetch" href="/assets/js/104.6415c50e.js"><link rel="prefetch" href="/assets/js/105.d79d3e11.js"><link rel="prefetch" href="/assets/js/106.e54af3e0.js"><link rel="prefetch" href="/assets/js/107.81005321.js"><link rel="prefetch" href="/assets/js/108.f5a33270.js"><link rel="prefetch" href="/assets/js/109.ae5298f8.js"><link rel="prefetch" href="/assets/js/11.3829db40.js"><link rel="prefetch" href="/assets/js/110.194ac2eb.js"><link rel="prefetch" href="/assets/js/111.6e7fe707.js"><link rel="prefetch" href="/assets/js/112.61cc9d22.js"><link rel="prefetch" href="/assets/js/113.d3f0314f.js"><link rel="prefetch" href="/assets/js/114.c7cb5e12.js"><link rel="prefetch" href="/assets/js/115.b6551b88.js"><link rel="prefetch" href="/assets/js/116.1496da4c.js"><link rel="prefetch" href="/assets/js/118.3bbcc28f.js"><link rel="prefetch" href="/assets/js/119.e0e97b90.js"><link rel="prefetch" href="/assets/js/12.3734f329.js"><link rel="prefetch" href="/assets/js/120.444e5052.js"><link rel="prefetch" href="/assets/js/121.362cfe2e.js"><link rel="prefetch" href="/assets/js/122.eaadaf77.js"><link rel="prefetch" href="/assets/js/123.b6b5c5fd.js"><link rel="prefetch" href="/assets/js/124.9874f788.js"><link rel="prefetch" href="/assets/js/125.9193edd8.js"><link rel="prefetch" href="/assets/js/126.ddc4474b.js"><link rel="prefetch" href="/assets/js/127.77536101.js"><link rel="prefetch" href="/assets/js/128.5dd52fc7.js"><link rel="prefetch" href="/assets/js/129.6c99a810.js"><link rel="prefetch" href="/assets/js/13.8bf0f23e.js"><link rel="prefetch" href="/assets/js/130.faa12e2e.js"><link rel="prefetch" href="/assets/js/131.ff600709.js"><link rel="prefetch" href="/assets/js/132.8d824641.js"><link rel="prefetch" href="/assets/js/133.c26af601.js"><link rel="prefetch" href="/assets/js/134.c932e5ca.js"><link rel="prefetch" href="/assets/js/135.1a11d73e.js"><link rel="prefetch" href="/assets/js/136.39cbc21a.js"><link rel="prefetch" href="/assets/js/137.21b966f9.js"><link rel="prefetch" href="/assets/js/138.9248d545.js"><link rel="prefetch" href="/assets/js/139.a304bb6f.js"><link rel="prefetch" href="/assets/js/14.b897aaa9.js"><link rel="prefetch" href="/assets/js/140.4f8b455e.js"><link rel="prefetch" href="/assets/js/141.d6ddbdd1.js"><link rel="prefetch" href="/assets/js/142.9d701fd3.js"><link rel="prefetch" href="/assets/js/143.4fedc479.js"><link rel="prefetch" href="/assets/js/144.0d30d704.js"><link rel="prefetch" href="/assets/js/145.47c48ec2.js"><link rel="prefetch" href="/assets/js/146.da2c710e.js"><link rel="prefetch" href="/assets/js/147.b69eceaa.js"><link rel="prefetch" href="/assets/js/148.6dce1a86.js"><link rel="prefetch" href="/assets/js/149.905b3fea.js"><link rel="prefetch" href="/assets/js/15.296f2506.js"><link rel="prefetch" href="/assets/js/150.609e2610.js"><link rel="prefetch" href="/assets/js/151.e4daa07f.js"><link rel="prefetch" href="/assets/js/152.96960b84.js"><link rel="prefetch" href="/assets/js/153.8b026a84.js"><link rel="prefetch" href="/assets/js/154.535d9002.js"><link rel="prefetch" href="/assets/js/155.d131882f.js"><link rel="prefetch" href="/assets/js/156.92594355.js"><link rel="prefetch" href="/assets/js/157.177b171c.js"><link rel="prefetch" href="/assets/js/158.ab8e722b.js"><link rel="prefetch" href="/assets/js/159.0b52ad96.js"><link rel="prefetch" href="/assets/js/16.adccd4e8.js"><link rel="prefetch" href="/assets/js/160.b3a57bd7.js"><link rel="prefetch" href="/assets/js/161.19741734.js"><link rel="prefetch" href="/assets/js/162.bf246d2a.js"><link rel="prefetch" href="/assets/js/163.17cf9d0d.js"><link rel="prefetch" href="/assets/js/164.e9a5db3b.js"><link rel="prefetch" href="/assets/js/165.7a695acf.js"><link rel="prefetch" href="/assets/js/166.e567e23a.js"><link rel="prefetch" href="/assets/js/167.49861f38.js"><link rel="prefetch" href="/assets/js/168.6f8b5b89.js"><link rel="prefetch" href="/assets/js/17.85c3c1f1.js"><link rel="prefetch" href="/assets/js/18.53360c2c.js"><link rel="prefetch" href="/assets/js/19.03f35ec0.js"><link rel="prefetch" href="/assets/js/20.f729ad0e.js"><link rel="prefetch" href="/assets/js/21.04d5ff0d.js"><link rel="prefetch" href="/assets/js/22.be6c32fa.js"><link rel="prefetch" href="/assets/js/23.efc1c82b.js"><link rel="prefetch" href="/assets/js/24.12a32996.js"><link rel="prefetch" href="/assets/js/25.bddeb4c3.js"><link rel="prefetch" href="/assets/js/26.85161e49.js"><link rel="prefetch" href="/assets/js/27.95bc6c7b.js"><link rel="prefetch" href="/assets/js/28.4ed8117b.js"><link rel="prefetch" href="/assets/js/29.e1c9da66.js"><link rel="prefetch" href="/assets/js/30.488c2a55.js"><link rel="prefetch" href="/assets/js/31.22627d31.js"><link rel="prefetch" href="/assets/js/32.0a1c75b8.js"><link rel="prefetch" href="/assets/js/33.2b56409c.js"><link rel="prefetch" href="/assets/js/34.949f2f08.js"><link rel="prefetch" href="/assets/js/35.30b31a5f.js"><link rel="prefetch" href="/assets/js/36.725999db.js"><link rel="prefetch" href="/assets/js/37.f96e32d8.js"><link rel="prefetch" href="/assets/js/38.a9bc1b6b.js"><link rel="prefetch" href="/assets/js/39.d83c0fdc.js"><link rel="prefetch" href="/assets/js/4.8191bfff.js"><link rel="prefetch" href="/assets/js/40.67b3ecf0.js"><link rel="prefetch" href="/assets/js/41.ca6c692b.js"><link rel="prefetch" href="/assets/js/42.8104214f.js"><link rel="prefetch" href="/assets/js/43.de53e242.js"><link rel="prefetch" href="/assets/js/44.ba235ee4.js"><link rel="prefetch" href="/assets/js/45.3114f8ea.js"><link rel="prefetch" href="/assets/js/46.be28e80a.js"><link rel="prefetch" href="/assets/js/47.540c8a33.js"><link rel="prefetch" href="/assets/js/48.16f0bcb2.js"><link rel="prefetch" href="/assets/js/49.62e71c16.js"><link rel="prefetch" href="/assets/js/5.599e6a7c.js"><link rel="prefetch" href="/assets/js/50.d7b6a73f.js"><link rel="prefetch" href="/assets/js/51.cd1681d8.js"><link rel="prefetch" href="/assets/js/52.912b7eb4.js"><link rel="prefetch" href="/assets/js/53.f63cbbaa.js"><link rel="prefetch" href="/assets/js/54.a0272657.js"><link rel="prefetch" href="/assets/js/55.304f3a6c.js"><link rel="prefetch" href="/assets/js/56.87f1f07e.js"><link rel="prefetch" href="/assets/js/57.bd29545b.js"><link rel="prefetch" href="/assets/js/58.71aa225e.js"><link rel="prefetch" href="/assets/js/59.de4b1bce.js"><link rel="prefetch" href="/assets/js/6.86af36b9.js"><link rel="prefetch" href="/assets/js/60.a96f7f49.js"><link rel="prefetch" href="/assets/js/61.fdf4d890.js"><link rel="prefetch" href="/assets/js/62.a46c4e4e.js"><link rel="prefetch" href="/assets/js/63.8b996549.js"><link rel="prefetch" href="/assets/js/64.7dbbcad1.js"><link rel="prefetch" href="/assets/js/65.fd2081e5.js"><link rel="prefetch" href="/assets/js/66.98915198.js"><link rel="prefetch" href="/assets/js/67.702c35c3.js"><link rel="prefetch" href="/assets/js/68.dc4a8d40.js"><link rel="prefetch" href="/assets/js/69.71fdb01b.js"><link rel="prefetch" href="/assets/js/7.096060b8.js"><link rel="prefetch" href="/assets/js/70.0d08616b.js"><link rel="prefetch" href="/assets/js/71.63f0a6b5.js"><link rel="prefetch" href="/assets/js/72.bbd78022.js"><link rel="prefetch" href="/assets/js/73.51adbfa1.js"><link rel="prefetch" href="/assets/js/74.98e47b95.js"><link rel="prefetch" href="/assets/js/75.5b3939ab.js"><link rel="prefetch" href="/assets/js/76.2e50b5f0.js"><link rel="prefetch" href="/assets/js/77.ccfd5f23.js"><link rel="prefetch" href="/assets/js/78.8abc56aa.js"><link rel="prefetch" href="/assets/js/79.c299f8de.js"><link rel="prefetch" href="/assets/js/8.b737c7b7.js"><link rel="prefetch" href="/assets/js/80.ccaa0b39.js"><link rel="prefetch" href="/assets/js/81.a7229866.js"><link rel="prefetch" href="/assets/js/82.487e273f.js"><link rel="prefetch" href="/assets/js/83.e4cbe993.js"><link rel="prefetch" href="/assets/js/84.f2ca382d.js"><link rel="prefetch" href="/assets/js/85.7012d877.js"><link rel="prefetch" href="/assets/js/86.5f31ac47.js"><link rel="prefetch" href="/assets/js/87.7387ff31.js"><link rel="prefetch" href="/assets/js/88.d992463d.js"><link rel="prefetch" href="/assets/js/89.014bfaf2.js"><link rel="prefetch" href="/assets/js/9.e7dfcdd2.js"><link rel="prefetch" href="/assets/js/90.496afa55.js"><link rel="prefetch" href="/assets/js/91.71f14531.js"><link rel="prefetch" href="/assets/js/92.7761c13e.js"><link rel="prefetch" href="/assets/js/93.60a806d9.js"><link rel="prefetch" href="/assets/js/94.d22093c0.js"><link rel="prefetch" href="/assets/js/95.a1d7fcb2.js"><link rel="prefetch" href="/assets/js/96.af12f65e.js"><link rel="prefetch" href="/assets/js/97.1f5d834b.js"><link rel="prefetch" href="/assets/js/98.e57ea119.js"><link rel="prefetch" href="/assets/js/99.c11b5ac6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4b97fc91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b0a18694.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/quick-starts/" class="sidebar-heading clickable open"><span>Quick Starts</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/quick-starts/in-memory.html" class="sidebar-link">In Memory</a></li><li><a href="/quick-starts/rabbitmq.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/quick-starts/azure-service-bus.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/quick-starts/sqs.html" class="sidebar-link">SQS</a></li></ul></section></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/templates.html" class="sidebar-link">Templates</a></li><li><a href="/usage/configuration.html" aria-current="page" class="active sidebar-link">Configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/usage/configuration.html#configuration-2" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/usage/configuration.html#consumers" class="sidebar-link">Consumers</a></li><li class="sidebar-sub-header"><a href="/usage/configuration.html#receive-endpoints" class="sidebar-link">Receive Endpoints</a></li><li class="sidebar-sub-header"><a href="/usage/configuration.html#health-checks" class="sidebar-link">Health Checks</a></li><li class="sidebar-sub-header"><a href="/usage/configuration.html#console-applications" class="sidebar-link">Console Applications</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/faas/" class="sidebar-heading clickable"><span>FaaS</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/guidance.html" class="sidebar-link">Guidance</a></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><a href="/support.html" class="sidebar-link">Support</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h1> <p>MassTransit can be used in most .NET application types. Commonly used application types are documented below, including the package references used, and show the minimal configuration required. More thorough configuration details can be found throughout the documentation.</p> <h2 id="configuration-2"><a href="#configuration-2" class="header-anchor">#</a> Configuration</h2> <blockquote><p>Uses <a href="https://nuget.org/packages/MassTransit/" target="_blank" rel="noopener noreferrer">MassTransit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://nuget.org/packages/MassTransit.RabbitMQ/" target="_blank" rel="noopener noreferrer">MassTransit.RabbitMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>MassTransit is easily configured in ASP.NET Core or .NET Generic Host applications (using .NET 3.1 or later). The built-in configuration will:</p> <ul><li>Add several interfaces (and their implementations)
<ul><li><em>IBusControl</em> (singleton)</li> <li><em>IBus</em> (singleton)</li> <li><em>IReceiveEndpointConnector</em> (singleton)</li> <li><em>ISendEndpointProvider</em> (scoped)</li> <li><em>IPublishEndpoint</em> (scoped)</li></ul></li> <li>Add a hosted service to start and stop the bus (or buses)</li> <li>Add health checks for the bus and receive endpoints</li> <li>Use <code>ILoggerFactory</code> to create log writers</li></ul> <p>To configure MassTransit so that it can be used to send/publish messages, the configuration below is recommended as a starting point.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">AspNetCorePublisher</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// OPTIONAL, but can be used to configure the bus options</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddOptions</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MassTransitHostOptions<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// if specified, waits until the bus is started before</span>
                <span class="token comment">// returning from IHostedService.StartAsync</span>
                <span class="token comment">// default is false</span>
                options<span class="token punctuation">.</span>WaitUntilStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token comment">// if specified, limits the wait time when starting the bus</span>
                options<span class="token punctuation">.</span>StartTimeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// if specified, limits the wait time when stopping the bus</span>
                options<span class="token punctuation">.</span>StopTimeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this example, MassTransit is configured to connect to RabbitMQ (which should be accessible on localhost) and publish messages. The messages can be published from a controller as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">EventContracts</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">record</span> <span class="token class-name">ValueEntered</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">init</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">namespace</span> <span class="token namespace">AspNetCorePublisher</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">EventContracts</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValueController</span> <span class="token punctuation">:</span>
        <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">readonly</span> <span class="token class-name">IPublishEndpoint</span> _publishEndpoint<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token function">ValueController</span><span class="token punctuation">(</span><span class="token class-name">IPublishEndpoint</span> publishEndpoint<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _publishEndpoint <span class="token operator">=</span> publishEndpoint<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> _publishEndpoint<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Publish</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Value <span class="token operator">=</span> <span class="token keyword">value</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>The configuration examples all use the <code>EventContracts.ValueEntered</code> message type. The message type is only included in the first example's source code.</p></blockquote> <h2 id="consumers"><a href="#consumers" class="header-anchor">#</a> Consumers</h2> <p>To configure a bus using RabbitMQ and register the consumers, sagas, and activities to be used by the bus, call the <code>AddMassTransit</code> extension method. The <em>UsingRabbitMq</em> method can be changed to the appropriate method for the proper transport if RabbitMQ is not being used.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainer</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ContainerConsumers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumerDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    x<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>AddConsumer</code> method is one of several methods used to register consumers, some of which are shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainerAddConsumer</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ContainerConsumers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// Add a single consumer</span>
                    x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumerDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Add a single consumer by type</span>
                    x<span class="token punctuation">.</span><span class="token function">AddConsumer</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumerDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Add all consumers in the specified assembly</span>
                    x<span class="token punctuation">.</span><span class="token function">AddConsumers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumer</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Add all consumers in the namespace containing the specified type</span>
                    x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumersFromNamespaceContaining</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="consumer-definition"><a href="#consumer-definition" class="header-anchor">#</a> Consumer Definition</h3> <p>A consumer definition is used to configure the receive endpoint and pipeline behavior for the consumer. When scanning assemblies or namespaces for consumers, consumer definitions are also found and added to the container. The <em>SubmitOrderConsumer</em> and matching definition are shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">ContainerConsumers</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ContainerContracts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SubmitOrderConsumer</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">SubmitOrderConsumer</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;Order Submitted: {OrderId}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Publish</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderSubmitted<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span>
        <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">SubmitOrderConsumerDefinition</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">ConsumerDefinition<span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">SubmitOrderConsumerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// override the default endpoint name</span>
        EndpointName <span class="token operator">=</span> <span class="token string">&quot;order-service&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// limit the number of messages consumed concurrently</span>
        <span class="token comment">// this applies to the consumer only, not the endpoint</span>
        ConcurrentMessageLimit <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureConsumer</span><span class="token punctuation">(</span><span class="token class-name">IReceiveEndpointConfigurator</span> endpointConfigurator<span class="token punctuation">,</span>
        <span class="token class-name">IConsumerConfigurator<span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span> consumerConfigurator<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// configure message retry with millisecond intervals</span>
        endpointConfigurator<span class="token punctuation">.</span><span class="token function">UseMessageRetry</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">Intervals</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// use the outbox to prevent duplicate events from being published</span>
        endpointConfigurator<span class="token punctuation">.</span><span class="token function">UseInMemoryOutbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="endpoint-definition"><a href="#endpoint-definition" class="header-anchor">#</a> Endpoint Definition</h3> <p>To configure the endpoint for a consumer registration, or override the endpoint configuration in the definition, the <code>Endpoint</code> method can be added to the consumer registration. This will create an endpoint definition for the consumer, and register it in the container. This method is available on consumer and saga registrations, with separate execute and compensate endpoint methods for activities.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainerAddConsumerEndpoint</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ContainerConsumers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumerDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Endpoint</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// override the default endpoint name</span>
                    e<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;order-service-extreme&quot;</span><span class="token punctuation">;</span>

                    <span class="token comment">// specify the endpoint as temporary (may be non-durable, auto-delete, etc.)</span>
                    e<span class="token punctuation">.</span>Temporary <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

                    <span class="token comment">// specify an optional concurrent message limit for the consumer</span>
                    e<span class="token punctuation">.</span>ConcurrentMessageLimit <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

                    <span class="token comment">// only use if needed, a sensible default is provided, and a reasonable</span>
                    <span class="token comment">// value is automatically calculated based upon ConcurrentMessageLimit if</span>
                    <span class="token comment">// the transport supports it.</span>
                    e<span class="token punctuation">.</span>PrefetchCount <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

                    <span class="token comment">// set if each service instance should have its own endpoint for the consumer</span>
                    <span class="token comment">// so that messages fan out to each instance.</span>
                    e<span class="token punctuation">.</span>InstanceId <span class="token operator">=</span> <span class="token string">&quot;something-unique&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When the endpoint is configured after the <em>AddConsumer</em> method, the configuration then overrides the endpoint configuration in the consumer definition. However, it cannot override the <code>EndpointName</code> if it is specified in the constructor. The order of precedence for endpoint naming is explained below.</p> <ol><li><p>Specifying <code>EndpointName = &quot;submit-order-extreme&quot;</code> in the constructor which cannot be overridden</p> <div class="language-cs extra-class"><pre class="language-cs"><code>x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">,</span> SubmitOrderConsumerDefinition<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span> <span class="token function">SubmitOrderConsumerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    EndpointName <span class="token operator">=</span> <span class="token string">&quot;submit-order-extreme&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Specifying <code>.Endpoint(x =&gt; x.Name = &quot;submit-order-extreme&quot;)</code> in the consumer registration, chained to <code>AddConsumer</code></p> <div class="language-cs extra-class"><pre class="language-cs"><code>x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">,</span> SubmitOrderConsumerDefinition<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Endpoint</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;submit-order-extreme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token function">SubmitOrderConsumerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Endpoint</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;not used&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Specifying <code>Endpoint(x =&gt; x.Name = &quot;submit-order-extreme&quot;)</code> in the constructor, which creates an endpoint definition</p> <div class="language-cs extra-class"><pre class="language-cs"><code>x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">,</span> SubmitOrderConsumerDefinition<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span> <span class="token function">SubmitOrderConsumerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Endpoint</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;submit-order-extreme&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Unspecified, the endpoint name formatter is used (in this case, the endpoint name is <code>SubmitOrder</code> using the default formatter)</p> <div class="language-cs extra-class"><pre class="language-cs"><code>x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">,</span> SubmitOrderConsumerDefinition<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span> <span class="token function">SubmitOrderConsumerDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="saga-registration"><a href="#saga-registration" class="header-anchor">#</a> Saga Registration</h3> <p>To add a state machine saga, use the <em>AddSagaStateMachine</em> methods. For a consumer saga, use the <em>AddSaga</em> methods.</p> <div class="custom-block tip"><p class="custom-block-title">Important</p> <p>State machine sagas should be added before class-based sagas, and the class-based saga methods should not be used to add state machine sagas. This may be simplified in the future, but for now, be aware of this registration requirement.</p></div> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// add a state machine saga, with the in-memory repository</span>
    r<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSagaStateMachine</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStateMachine<span class="token punctuation">,</span> OrderState<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">InMemoryRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add a consumer saga with the in-memory repository</span>
    r<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSaga</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderSaga<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">InMemoryRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add a saga by type, without a repository. The repository should be registered</span>
    <span class="token comment">// in the container elsewhere</span>
    r<span class="token punctuation">.</span><span class="token function">AddSaga</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderSaga</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add a state machine saga by type, including a saga definition for that saga</span>
    r<span class="token punctuation">.</span><span class="token function">AddSagaStateMachine</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderState</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderStateDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// add all saga state machines by type</span>
    r<span class="token punctuation">.</span><span class="token function">AddSagaStateMachines</span><span class="token punctuation">(</span>Assembly<span class="token punctuation">.</span><span class="token function">GetExecutingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add all sagas in the specified assembly</span>
    r<span class="token punctuation">.</span><span class="token function">AddSagas</span><span class="token punctuation">(</span>Assembly<span class="token punctuation">.</span><span class="token function">GetExecutingAssembly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add sagas from the namespace containing the type</span>
    r<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSagasFromNamespaceContaining</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderSaga<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    r<span class="token punctuation">.</span><span class="token function">AddSagasFromNamespaceContaining</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">OrderSaga</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To add a saga registration and configure the consumer endpoint in the same expression, a definition can automatically be created.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    r<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSagaStateMachine</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStateMachine<span class="token punctuation">,</span> OrderState<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">NHibernateRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Endpoint</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;order-state&quot;</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>ConcurrentMessageLimit <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Supported saga persistence storage engines are documented in the <a href="/usage/sagas/persistence">saga documentation</a> section.</p> <h2 id="receive-endpoints"><a href="#receive-endpoints" class="header-anchor">#</a> Receive Endpoints</h2> <p>In the above examples, the bus is configured by the <em>UsingRabbitMq</em> method, which is passed two arguments. <code>context</code> is the registration context, used to configure endpoints. <code>cfg</code> is the bus factory configurator, used to configure the bus. The above examples use the default conventions to configure the endpoints. Alternatively, endpoints can be explicitly configured. However, when configuring endpoints manually, the <em>ConfigureEndpoints</em> methods may be excluded otherwise it should appear <strong>after</strong> any manually configured receive endpoints.</p> <p><em>ConfigureEndpoints</em> uses an <code>IEndpointNameFormatter</code> to generate endpoint names, which by default uses a <em>PascalCase</em> formatter. There are two additional endpoint name formatters included, snake and kebab case.</p> <p>For the <em>SubmitOrderConsumer</em>, the endpoint names would be:</p> <table><thead><tr><th style="text-align:left;">Formatter</th> <th style="text-align:left;">Name</th></tr></thead> <tbody><tr><td style="text-align:left;">Default</td> <td style="text-align:left;"><code>SubmitOrder</code></td></tr> <tr><td style="text-align:left;">Snake Case</td> <td style="text-align:left;"><code>submit_order</code></td></tr> <tr><td style="text-align:left;">Kebab Case</td> <td style="text-align:left;"><code>submit-order</code></td></tr></tbody></table> <p>All of the included formatters trim the <em>Consumer</em>, <em>Saga</em>, or <em>Activity</em> suffix from the end of the class name. If the consumer name is generic, the generic parameter type is used instead of the generic type.</p> <div class="custom-block tip"><p class="custom-block-title">Video</p> <p>Learn about the default conventions as well as how to tailor the naming style to meet your requirements in <a href="https://youtu.be/bsUlQ93j2MY" target="_blank" rel="noopener noreferrer">this short video<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <p>The endpoint name formatter can be set as shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainerFormatter</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">SetSnakeCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The endpoint formatter can also be passed to the <em>ConfigureEndpoints</em> method as shown.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainerFormatterInline</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> KebabCaseEndpointNameFormatter<span class="token punctuation">.</span>Instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To explicitly configure endpoints, use the <em>ConfigureConsumer</em> and/or <em>ConfigureConsumers</em> methods.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MicrosoftContainerConfigureConsumer</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">ContainerConsumers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SubmitOrderConsumerDefinition</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;order-service&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConfigureConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrderConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When using <em>ConfigureConsumer</em>, the <em>EndpointName</em>, <em>PrefetchCount</em>, and <em>Temporary</em> properties of the consumer definition are not used.</p> <p>MassTransit includes an endpoint name formatter (<em>IEndpointNameFormatter</em>) which can be used to automatically format endpoint names based upon the consumer, saga, or activity name. Using the <em>ConfigureEndpoints</em> method will automatically create a receive endpoint for every added consumer, saga, and activity. To automatically configure the receive endpoints, use the updated configuration shown below.</p> <p>The example sets the kebab-case endpoint name formatter, which will create a receive endpoint named <code>value-entered-event</code> for the <code>ValueEnteredEventConsumer</code>. The <em>Consumer</em> suffix is removed by default. The endpoint is named based upon the consumer name, not the message type, since a consumer may consume multiple message types yet still be configured on a single receive endpoint.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">AspNetCoreEndpointListener</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventContracts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ValueEnteredEventConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">SetKebabCaseEndpointNameFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ValueEnteredEventConsumer</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ValueEnteredEventConsumer<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">ValueEnteredEventConsumer</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ValueEnteredEventConsumer<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {Value}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>An ASP.NET Core application can also configure receive endpoints. The consumer, along with the receive endpoint, is configured within the <em>AddMassTransit</em> configuration. Separate registration of the consumer is not required (and discouraged), however, any consumer dependencies should be added to the container separately. Consumers are registered as scoped, and dependencies should be registered as scoped when possible, unless they are singletons.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">AspNetCoreListener</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventContracts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EventConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> cfg<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;event-listener&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConfigureConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EventConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">EventConsumer</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>EventConsumer<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">EventConsumer</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>EventConsumer<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {Value}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="health-checks"><a href="#health-checks" class="header-anchor">#</a> Health Checks</h2> <p>The <em>AddMassTransit</em> method adds bus health checks to the service collection. To configure health checks, map the ready and live endpoints in your ASP.NET application.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">AspNetCorePublisherHealthCheck</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Builder</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>HealthChecks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>DependencyInjection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>HealthChecks</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        services<span class="token punctuation">.</span><span class="token function">AddHealthChecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Configure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HealthCheckPublisherOptions<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span>Delay <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            options<span class="token punctuation">.</span>Predicate <span class="token operator">=</span> <span class="token punctuation">(</span>check<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> check<span class="token punctuation">.</span>Tags<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span><span class="token function">UsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecks</span><span class="token punctuation">(</span><span class="token string">&quot;/health/ready&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HealthCheckOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Predicate <span class="token operator">=</span> <span class="token punctuation">(</span>check<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> check<span class="token punctuation">.</span>Tags<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            endpoints<span class="token punctuation">.</span><span class="token function">MapHealthChecks</span><span class="token punctuation">(</span><span class="token string">&quot;/health/live&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HealthCheckOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="console-applications"><a href="#console-applications" class="header-anchor">#</a> Console Applications</h2> <blockquote><p>Uses <a href="https://nuget.org/packages/MassTransit.RabbitMQ/" target="_blank" rel="noopener noreferrer">MassTransit.RabbitMQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>For environments where the generic host is unavailable, MassTransit can be configured without a container. In this example, MassTransit is configured in a simple console application to connect to RabbitMQ (which should be accessible on <em>localhost</em>) and publish messages. As each value is entered, the value is published as a <code>ValueEntered</code> message. No consumers are configured in this example.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">ConsoleEventPublisher</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventContracts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Enter message (or quit to exit)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;quit&quot;</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>OrdinalIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Publish</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    Value <span class="token operator">=</span> <span class="token keyword">value</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Another console application can be created to consume the published events. In this application, the receive endpoint is configured with a consumer that consumes the <code>ValueEntered</code> event. The message contract from the example above, in the same namespace, should be copied to this program as well (it isn't shown below).</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">ConsoleEventListener</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">EventContracts</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;event-listener&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EventConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Press enter to exit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">class</span> <span class="token class-name">EventConsumer</span> <span class="token punctuation">:</span>
        <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>ValueEntered<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/configuration.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/29/2023, 4:08:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/usage/templates.html" class="prev">
        Templates
      </a></span> <span class="next"><a href="/usage/transports/rabbitmq.html">
        RabbitMQ
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f6b98727.js" defer></script><script src="/assets/js/3.5d941158.js" defer></script><script src="/assets/js/117.e885181b.js" defer></script>
  </body>
</html>
