(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{398:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"key-concepts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#key-concepts"}},[s._v("#")]),s._v(" Key concepts")]),s._v(" "),t("p",[s._v("When getting started using MassTransit, it is a good idea to have a handle on messaging concepts and terminology. To ensure that you are on the right path when looking at a class or interface, here are some of the terms used when working with MassTransit.")]),s._v(" "),t("h2",{attrs:{id:"message-contracts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#message-contracts"}},[s._v("#")]),s._v(" Message contracts")]),s._v(" "),t("p",[s._v("A message contract defines a "),t("em",[s._v("contract")]),s._v(" between a message producer and a message consumer. In MassTransit, message contracts are declared using types, which should be "),t("em",[s._v("interfaces")]),s._v(" in .NET, but may also be classes. For example, a simple command contract for submitting an order is shown below.")]),s._v(" "),t("div",{staticClass:"language-csharp extra-class"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SubmitOrder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Guid")]),s._v(" OrderId "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("DateTimeOffset")]),s._v(" SubmitDate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")])]),s._v(" OrderNumber "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("OrderItem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v(" Items "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderItem")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("string")])]),s._v(" ItemNumber "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")])]),s._v(" Quantity "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"serialization"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#serialization"}},[s._v("#")]),s._v(" Serialization")]),s._v(" "),t("p",[s._v("MassTransit is a service bus, and a service bus is designed to move "),t("em",[s._v("messages")]),s._v(". At the lowest level, a message is a byte array ("),t("code",[s._v("byte[]")]),s._v(") which may represent JSON, XML, or encrypted data.")]),s._v(" "),t("p",[s._v("When sending a message, MassTransit uses a message serializer to convert message contract instances (objects) into JSON, XML, or whatever output format is generated by the serializer. When receiving that message, a message deserializer is used to convert the formatted data back into the message contract.")]),s._v(" "),t("p",[s._v("By default, MassTransit uses JSON to serialize messages, while simultaneously suppporting the deserialization of JSON, BSON, and XML messages. Additional deserializers can be added, and the serializer can be changed for each receive endpoint or the entire bus.")]),s._v(" "),t("p",[s._v("To specify that XML should be used when sending messages:")]),s._v(" "),t("div",{staticClass:"language-csharp extra-class"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[s._v("Bus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateUsingInMemory")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cfg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cfg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("UseXmlSerializer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("Other serializers can be configured using other configuration methods.")]),s._v(" "),t("h2",{attrs:{id:"consumers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#consumers"}},[s._v("#")]),s._v(" Consumers")]),s._v(" "),t("p",[s._v("Consumers are classes used to "),t("em",[s._v("consume")]),s._v(" messages. Conceptually they are similar to "),t("em",[s._v("Controllers")]),s._v(" in a Web API, in that consumers implement a generic interface to specify the message types to be consumed.")]),s._v(" "),t("p",[s._v("An example consumer that consumes the sample message contract above is shown below.")]),s._v(" "),t("div",{staticClass:"language-csharp extra-class"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SubmitOrderConsumer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token type-list"}},[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IConsumer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SubmitOrder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Consume")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SubmitOrder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// do the thing")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("Consumers are stateless by design, and MassTransit makes no effort to correlate messages to a specific consumer instance. For each message, a consumer factory is used to create a consumer instance to which that message is delivered.")]),s._v(" "),t("h2",{attrs:{id:"sagas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sagas"}},[s._v("#")]),s._v(" Sagas")]),s._v(" "),t("p",[s._v("In MassTransit, a saga is a stateful consumer that allows multiple messages to be correlated to a single consumer instance. A saga, sometimes called a workflow, is typically used to orchestrate other consumers or services in a distributed system while maintaining state between messages. MassTransit persists a saga's state using a saga repository, and automatically creates a new or uses an existing state instance as messages are received.")]),s._v(" "),t("blockquote",[t("p",[s._v("Consider a saga a long-running transaction that is managed at the application layer instead of being handled inside a database or by a distributed transaction coordinator.")])]),s._v(" "),t("p",[s._v("MassTransit supports simple class-based sagas and powerful, advanced state machine sagas using "),t("em",[s._v("Automatonymous")]),s._v(" - a declarative state machine library. In a class-based saga, messages are correlated using a "),t("code",[s._v("Guid CorrelationId")]),s._v(" property and must implement the "),t("code",[s._v("CorrelatedBy<Guid>")]),s._v(" interface. Class-based sagas can also "),t("em",[s._v("observe")]),s._v(" messages by specifying a correlation expression, but caution should be used to avoid matching a message to hundreds of saga instances which may cause performance issues.")]),s._v(" "),t("p",[s._v("A simple saga is shown below as an example, which monitors the completion time of orders.")]),s._v(" "),t("div",{staticClass:"language-csharp extra-class"},[t("pre",{pre:!0,attrs:{class:"language-csharp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OrderToCompletionSaga")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token type-list"}},[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ISaga")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InitiatedBy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("OrderSubmitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Orchestrates"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("OrderCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Guid")]),s._v(" CorrelationId "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("DateTime")]),s._v(" Submitted "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("DateTime")]),s._v(" Completed "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Consume")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("OrderSubmitted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Submitted "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OrderDate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s._v("Task")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Consume")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConsumeContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("OrderCompleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Completed "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompletionDate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"transports-and-endpoints"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#transports-and-endpoints"}},[s._v("#")]),s._v(" Transports and endpoints")]),s._v(" "),t("p",[s._v("MassTransit is a framework, and being a framework has certain rules. The first of which is known as the Hollywood principle -- \"Don't call us, we'll call you.\" Once the bus is configured and running, message consumer are called by the framework as messages are received. There is no need for the application to poll a message queue or make repeated calls to a framework method in a loop.")]),s._v(" "),t("div",{staticClass:"alert alert-info"},[t("b",[s._v("Note:")]),s._v("\nA way to understand this is to think of a message consumer as being similar to a controller in a web application. With a web application, the socket and HTTP protocol are under the hood, and the controller is created and an action method is called by the web framework. MassTransit is similar, it handles the message reception, creates the consumers, and calls the Consume method.\n")]),s._v(" "),t("p",[s._v("To initiate the calls into your application code, MassTransit creates an abstraction on top of the messaging platform (such as RabbitMQ).")]),s._v(" "),t("h3",{attrs:{id:"transports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#transports"}},[s._v("#")]),s._v(" Transports")]),s._v(" "),t("p",[s._v("The transport is at the lowest level and is closest to the actual message broker. The transport communicates with the broker, responsible for sending and receiving messages. The send and receive sections of the transport are completely independent, keeping reads and writes separate in line with the Command Query Responsibility Segregation (CQRS) pattern.")]),s._v(" "),t("h3",{attrs:{id:"receive-endpoints"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#receive-endpoints"}},[s._v("#")]),s._v(" Receive endpoints")]),s._v(" "),t("p",[s._v("A receive endpoint receives messages from a transport, deserializes the message body, and routes the message to the consumers. Applications do not interact with receive endpoints, other than to configure and connect consumers. The rest of the work is done entirely by MassTransit.")]),s._v(" "),t("h3",{attrs:{id:"send-endpoints"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#send-endpoints"}},[s._v("#")]),s._v(" Send endpoints")]),s._v(" "),t("p",[s._v("A send endpoint is used by an application to send a message to a specific address. They can be obtained from the "),t("code",[s._v("ConsumeContext")]),s._v(" or the "),t("code",[s._v("IBus")]),s._v(" and support a variety of message types.")]),s._v(" "),t("h3",{attrs:{id:"endpoint-addressing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#endpoint-addressing"}},[s._v("#")]),s._v(" Endpoint addressing")]),s._v(" "),t("p",[s._v("MassTransit uses Universal Resource Identifiers (URIs) to identify endpoints. URIs are flexible and easy to include additional information, such as queue or exchange types. An example RabbitMQ endpoint address for "),t("em",[s._v("my_queue")]),s._v(" on the local machine would be: "),t("code",[s._v("rabbitmq://localhost/my_queue")])])])}),[],!1,null,null,null);t.default=n.exports}}]);