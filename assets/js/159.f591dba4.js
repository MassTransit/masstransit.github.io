(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{576:function(t,s,e){"use strict";e.r(s);var a=e(34),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"rabbitmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq"}},[t._v("#")]),t._v(" RabbitMQ")]),t._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://nuget.org/packages/MassTransit.RabbitMQ/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MassTransit.RabbitMQ"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("With tens of thousands of users, RabbitMQ is one of the most popular open source message brokers. RabbitMQ is lightweight and easy to deploy on premises and in the cloud. RabbitMQ can be deployed in distributed and federated configurations to meet high-scale, high-availability requirements.")]),t._v(" "),e("p",[t._v("MassTransit fully supports RabbitMQ, including many of the advanced features and capabilities.")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("Getting Started")]),t._v(" "),e("p",[t._v("To get started with RabbitMQ, refer to the "),e("a",{attrs:{href:"/usage/configuration"}},[t._v("configuration")]),t._v(" section which uses RabbitMQ in the examples.")])]),t._v(" "),e("h2",{attrs:{id:"broker-topology"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#broker-topology"}},[t._v("#")]),t._v(" Broker Topology")]),t._v(" "),e("p",[t._v("With RabbitMQ, which supports exchanges and queues, messages are "),e("em",[t._v("sent")]),t._v(" or "),e("em",[t._v("published")]),t._v(" to exchanges and RabbitMQ routes those messages through exchanges to the appropriate queues.")]),t._v(" "),e("h2",{attrs:{id:"examples"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[t._v("#")]),t._v(" Examples")]),t._v(" "),e("h3",{attrs:{id:"minimal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minimal"}},[t._v("#")]),t._v(" Minimal")]),t._v(" "),e("p",[t._v("In the example below, which configures a receive endpoint, consumer, and message type, the bus is configured to use RabbitMQ.")]),t._v(" "),e("div",{staticClass:"language-cs extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cs"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("OrderSystem"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Events")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OrderSubmitted")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Guid")]),t._v(" OrderId "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("RabbitMqConsoleListener")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("OrderSystem"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Events")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("MassTransit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("Microsoft"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Extensions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Hosting")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Program")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v(" args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Host"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateDefaultBuilder")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfigureServices")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("services "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    services"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddMassTransit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UsingRabbitMq")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cfg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            cfg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"guest"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                                h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"guest"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                            cfg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReceiveEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"order-events-listener"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token generic-method"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Consumer")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("OrderSubmittedEventConsumer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("RunAsync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OrderSubmittedEventConsumer")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token type-list"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IConsumer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("OrderSubmitted"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Consume")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumeContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("OrderSubmitted"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                Console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("WriteLine")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Order Submitted: {0}"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("The configuration includes:")]),t._v(" "),e("ul",[e("li",[t._v("The RabbitMQ host\n"),e("ul",[e("li",[t._v("Host name: "),e("code",[t._v("localhost")])]),t._v(" "),e("li",[t._v("Virtual host: "),e("code",[t._v("/")])]),t._v(" "),e("li",[t._v("User name and password used to connect to the virtual host (credentials are virtual-host specific)")])])]),t._v(" "),e("li",[t._v("The receive endpoint\n"),e("ul",[e("li",[t._v("Queue name: "),e("code",[t._v("order-events-listener")])]),t._v(" "),e("li",[t._v("Consumer: "),e("code",[t._v("OrderSubmittedEventConsumer")]),t._v(" "),e("ul",[e("li",[t._v("Message type: "),e("code",[t._v("OrderSystem.Events.OrderSubmitted")])])])])])])]),t._v(" "),e("p",[t._v("When the bus is started, MassTransit will create exchanges and queues on the virtual host for the receive endpoint. MassTransit creates durable, "),e("em",[t._v("fanout")]),t._v(" exchanges by default, and queues are also durable by default.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Name")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("order-events-listener")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Queue for the receive endpoint")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("order-events-listener")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("An exchange, bound to the queue, used to "),e("em",[t._v("send")]),t._v(" messages")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("OrderSystem.Events:OrderSubmitted")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("An exchange, named by the message-type, bound to the "),e("em",[t._v("order-events-listener")]),t._v(" exchange, used to "),e("em",[t._v("publish")]),t._v(" messages")])])])]),t._v(" "),e("p",[t._v("When a message is sent, the endpoint address can be one of two values:")]),t._v(" "),e("p",[e("code",[t._v("exchange:order-events-listener")])]),t._v(" "),e("p",[t._v("Send the message to the "),e("em",[t._v("order-events-listener")]),t._v(" exchange. If the exchange does not exist, it will be created. "),e("em",[t._v("MassTransit translates topic: to exchange: when using RabbitMQ, so that topic: addresses can be resolved – since RabbitMQ is the only supported transport that doesn't have topics.")])]),t._v(" "),e("p",[e("code",[t._v("queue:order-events-listener")])]),t._v(" "),e("p",[t._v("Send the message to the "),e("em",[t._v("order-events-listener")]),t._v(" exchange. If the exchange or queue does not exist, they will be created and the exchange will be bound to the queue.")]),t._v(" "),e("p",[t._v("With either address, RabbitMQ will route the message from the "),e("em",[t._v("order-events-listener")]),t._v(" exchange to the "),e("em",[t._v("order-events-listener")]),t._v(" queue.")]),t._v(" "),e("p",[t._v("When a message is published, the message is sent to the "),e("em",[t._v("OrderSystem.Events:OrderSubmitted")]),t._v(" exchange. If the exchange does not exist, it will be created. RabbitMQ will route the message from the "),e("em",[t._v("OrderSystem.Events:OrderSubmitted")]),t._v(" exchange to the "),e("em",[t._v("order-events-listener")]),t._v(" exchange, and subsequently to the "),e("em",[t._v("order-events-listener")]),t._v(" queue. If other receive endpoints connected to the same virtual host include consumers that consume the "),e("em",[t._v("OrderSubmitted")]),t._v(" message, a copy of the message would be routed to each of those endpoints as well.")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("If a message is published before starting the bus, so that MassTransit can create the exchanges and queues, the exchange "),e("em",[t._v("OrderSystem.Events:OrderSubmitted")]),t._v(" will be created. However, until the bus has been started at least once, there won't be a queue bound to the exchange and any published messages will be lost. Once the bus has been started, the queue will remain bound to the exchange even when the bus is stopped.")])]),t._v(" "),e("p",[t._v("Durable exchanges and queues remain configured on the virtual host, so even if the bus is stopped messages will continue to be routed to the queue. When the bus is restarted, queued messages will be consumed.")]),t._v(" "),e("h2",{attrs:{id:"configuration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),e("p",[t._v("MassTransit includes several host-level configuration options that control the behavior for the entire bus.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Property")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("PublisherConfirmation")]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[t._v("MassTransit will wait until RabbitMQ confirms messages when publishing or sending messages (default: true)")])]),t._v(" "),e("tr",[e("td",[t._v("Heartbeat")]),t._v(" "),e("td",[t._v("TimeSpan")]),t._v(" "),e("td",[t._v("The heartbeat interval used by the RabbitMQ client to keep the connection alive")])]),t._v(" "),e("tr",[e("td",[t._v("RequestedChannelMax")]),t._v(" "),e("td",[t._v("ushort")]),t._v(" "),e("td",[t._v("The maximum number of channels allowed on the connection")])]),t._v(" "),e("tr",[e("td",[t._v("RequestedConnectionTimeout")]),t._v(" "),e("td",[t._v("TimeSpan")]),t._v(" "),e("td",[t._v("The connection timeout")])])])]),t._v(" "),e("h4",{attrs:{id:"usecluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usecluster"}},[t._v("#")]),t._v(" UseCluster")]),t._v(" "),e("p",[t._v("MassTransit can connect to a cluster of RabbitMQ virtual hosts and treat them as a single virtual host. To configure a cluster, call the "),e("code",[t._v("UseCluster")]),t._v(" methods, and add the cluster nodes, each of which becomes part of the virtual host identified by the host name. Each cluster node can specify either a "),e("code",[t._v("host")]),t._v(" or a "),e("code",[t._v("host:port")]),t._v(" combination.")]),t._v(" "),e("h4",{attrs:{id:"configurebatch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configurebatch"}},[t._v("#")]),t._v(" ConfigureBatch")]),t._v(" "),e("p",[t._v("MassTransit will briefly buffer messages before sending them to RabbitMQ, to increase message throughput. While use of the default values is recommended, the batch options can be configured.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Property")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Default")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("Enabled")]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[t._v("true")]),t._v(" "),e("td",[t._v("Enable or disable batch sends to RabbitMQ")])]),t._v(" "),e("tr",[e("td",[t._v("MessageLimit")]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[t._v("100")]),t._v(" "),e("td",[t._v("Limit the number of messages per batch")])]),t._v(" "),e("tr",[e("td",[t._v("SizeLimit")]),t._v(" "),e("td",[t._v("int")]),t._v(" "),e("td",[t._v("64K")]),t._v(" "),e("td",[t._v("A rough limit of the total message size")])]),t._v(" "),e("tr",[e("td",[t._v("Timeout")]),t._v(" "),e("td",[t._v("TimeSpan")]),t._v(" "),e("td",[t._v("1ms")]),t._v(" "),e("td",[t._v("The time to wait for additional messages before sending")])])])]),t._v(" "),e("p",[t._v("MassTransit includes several receive endpoint level configuration options that control receive endpoint behavior.")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Property")]),t._v(" "),e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("PrefetchCount")]),t._v(" "),e("td",[t._v("ushort")]),t._v(" "),e("td",[t._v("The number of unacknowledged messages that can be processed concurrently (default based on CPU count)")])]),t._v(" "),e("tr",[e("td",[t._v("PurgeOnStartup")]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[t._v("Removes all messages from the queue when the bus is started (default: false)")])]),t._v(" "),e("tr",[e("td",[t._v("AutoDelete")]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[t._v("If true, the queue will be automatically deleted when the bus is stopped (default: false)")])]),t._v(" "),e("tr",[e("td",[t._v("Durable")]),t._v(" "),e("td",[t._v("bool")]),t._v(" "),e("td",[t._v("If true, messages are persisted to disk before being acknowledged (default: true)")])])])]),t._v(" "),e("h2",{attrs:{id:"cloudamqp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cloudamqp"}},[t._v("#")]),t._v(" CloudAMQP")]),t._v(" "),e("p",[t._v("MassTransit can be used with CloudAMQP, which is a great SaaS-based solution to host your RabbitMQ broker. To configure MassTransit, the host and virtual host must be specified, and "),e("em",[t._v("UseSsl")]),t._v(" must be configured.")]),t._v(" "),e("div",{staticClass:"language-cs extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cs"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("CloudAmqpConsoleListener")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Security"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Authentication")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("MassTransit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Program")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" busControl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Bus"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateUsingRabbitMq")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                cfg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wombat.rmq.cloudamqp.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5671")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_vhost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_vhost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_password"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseSsl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Protocol "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SslProtocols"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tls12"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"amazonmq-rabbitmq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#amazonmq-rabbitmq"}},[t._v("#")]),t._v(" AmazonMQ - RabbitMQ")]),t._v(" "),e("p",[t._v("AmazonMQ now includes "),e("a",{attrs:{href:"https://us-east-2.console.aws.amazon.com/amazon-mq/home",target:"_blank",rel:"noopener noreferrer"}},[t._v("RabbitMQ support"),e("OutboundLink")],1),t._v(", which means the best message broker can now be used easily on AWS. To configure MassTransit, the AMQPS endpoint address can be used to configure the host as shown below.")]),t._v(" "),e("div",{staticClass:"language-cs extra-class"},[e("pre",{pre:!0,attrs:{class:"language-cs"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("AmazonRabbitMqConsoleListener")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("MassTransit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Program")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Main")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" busControl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Bus"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateUsingRabbitMq")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                cfg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Uri")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"amqps://b-12345678-1234-1234-1234-123456789012.mq.us-east-2.amazonaws.com:5671"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Username")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    h"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"guidance"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#guidance"}},[t._v("#")]),t._v(" Guidance")]),t._v(" "),e("p",[t._v("The following recommendations should be considered "),e("em",[t._v("best practices")]),t._v(" for building applications using MassTransit, specifically with RabbitMQ.")]),t._v(" "),e("ul",[e("li",[t._v("Published messages are routed to a receive endpoint queue by message type, using exchanges and exchange bindings. A service's receive endpoints do not affect other services or their receive endpoints, as long as they do not share the same queue.")]),t._v(" "),e("li",[t._v("Consumers and sagas should have their own receive endpoint, with a unique queue name\n"),e("ul",[e("li",[t._v("Each receive endpoint maps to one queue")]),t._v(" "),e("li",[t._v("A queue may contain more than one message type, the message type is used to deliver the message to the appropriate consumer configured on the receive endpoint.")]),t._v(" "),e("li",[t._v("If a received message is not handled by a consumer, the skipped message will be moved to a skipped queue, which is named with a _skipped suffix.")])])]),t._v(" "),e("li",[t._v("When running multiple instances of the same service\n"),e("ul",[e("li",[t._v("Use the same queue name for each instance")]),t._v(" "),e("li",[t._v("Messages from the queue will be load balanced across all instances (the "),e("em",[t._v("competing consumer")]),t._v(" pattern)")])])]),t._v(" "),e("li",[t._v("If a consumer exception is thrown, the faulted message will be moved to an error queue, which is named with the _error suffix.")]),t._v(" "),e("li",[t._v("The number of concurrently processed messages can be up to the "),e("em",[t._v("PrefetchCount")]),t._v(", depending upon the number of cores available.")]),t._v(" "),e("li",[t._v("For temporary receive endpoints that should be deleted when the bus is stopped, use "),e("em",[t._v("TemporaryEndpointDefinition")]),t._v(" as the receive endpoint definition.")]),t._v(" "),e("li",[t._v("To configure "),e("em",[t._v("PrefetchCount")]),t._v(" higher than the desired concurrent message count, add "),e("em",[t._v("UseConcurrencyLimit(n)")]),t._v(" to the configuration. "),e("em",[t._v("This must be added before any consumers are configured.")]),t._v(" Depending upon your consumer duration, higher values may greatly improve overall message throughput.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);