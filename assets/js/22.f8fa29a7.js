(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{441:function(t,e,a){"use strict";a.r(e);var s=a(34),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"circuit-breaker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#circuit-breaker"}},[t._v("#")]),t._v(" Circuit Breaker")]),t._v(" "),a("p",[t._v("A circuit breaker is used to protect resources (remote, local, or otherwise) from being overloaded when\nin a failure state. For example, a remote web site may be unavailable and calling that web site in a\nmessage consumer takes 30-60 seconds to time out. By continuing to call the failing service, the service\nmay be unable to recover. A circuit breaker detects the repeated failures and trips, preventing further\ncalls to the service and giving it time to recover. Once the reset interval expires, calls are slowly allowed\nback to the service. If it is still failing, the breaker remains open, and the timeout interval resets.\nOnce the service returns to healthy, calls flow normally as the breaker closes.")]),t._v(" "),a("p",[t._v("Read Martin Fowler's description of the pattern "),a("a",{attrs:{href:"http://martinfowler.com/bliki/CircuitBreaker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("To add the circuit breaker to a receive endpoint:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[t._v("cfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReceiveEndpoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customer_update_queue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseCircuitBreaker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cb "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TrackingPeriod "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TimeSpan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FromMinutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TripThreshold "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ActiveThreshold "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResetInterval "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TimeSpan"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FromMinutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("There are four settings that can be adjusted on a circuit breaker.")]),t._v(" "),a("h3",{attrs:{id:"trackingperiod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trackingperiod"}},[t._v("#")]),t._v(" TrackingPeriod")]),t._v(" "),a("p",[t._v("The window of time before the success/failure counts are reset to zero. This is typically set to around\none minute, but can be as high as necessary. More than ten seems really strange to me.")]),t._v(" "),a("h3",{attrs:{id:"tripthreshold"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tripthreshold"}},[t._v("#")]),t._v(" TripThreshold")]),t._v(" "),a("p",[t._v("This is a percentage, and is based on the ratio of successful to failed attempts. When set to 15, if the ratio\nexceeds 15%, the circuit breaker opens and remains open until the "),a("code",[t._v("ResetInterval")]),t._v(" expires.")]),t._v(" "),a("h3",{attrs:{id:"activethreshold"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#activethreshold"}},[t._v("#")]),t._v(" ActiveThreshold")]),t._v(" "),a("p",[t._v("This is the number of messages that must reach the circuit breaker in a tracking period before the circuit breaker\ncan trip. If set to 10, the trip threshold is not evaluated until at least 10 messages have been received.")]),t._v(" "),a("h3",{attrs:{id:"resetinterval"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resetinterval"}},[t._v("#")]),t._v(" ResetInterval")]),t._v(" "),a("p",[t._v("The period of time between the circuit breaker trip and the first attempt to close the circuit breaker. Messages\nthat reach the circuit breaker during the open period will immediately fail with the same exception that tripped\nthe circuit breaker.")])])}),[],!1,null,null,null);e.default=r.exports}}]);